# Hướng dẫn Quản lý Vé - QLVeTau

## Tổng quan

Hệ thống QLVeTau đã được cải tiến với giao diện quản lý vé hoàn toàn mới, cho phép:
- ✅ Đặt vé với chọn toa và ghế trực quan
- ✅ Hoàn vé cho khách hàng
- ✅ Đổi vé (thay đổi chuyến tàu và ghế)

## Truy cập Quản lý Vé

Từ thanh điều hướng chính, nhấn vào **"Quản lý vé ▾"** để xem menu dropdown với 3 lựa chọn:
1. Đặt vé
2. Hoàn vé
3. Đổi vé

---

## 1. Đặt Vé

### Quy trình đặt vé mới

#### Bước 1: Chọn thông tin cơ bản
1. Chọn **chuyến tàu** từ danh sách dropdown
2. Chọn **khách hàng** từ danh sách dropdown
3. Nhấn "Làm mới" nếu cần cập nhật danh sách

#### Bước 2: Chọn toa tàu
- Sau khi chọn chuyến tàu, danh sách các toa sẽ hiển thị bên trái
- Mỗi toa hiển thị: Số toa và tên toa
- Ví dụ: "Toa 1: Ghế ngồi cứng"
- Nhấn vào toa muốn chọn

#### Bước 3: Chọn ghế ngồi
- Sau khi chọn toa, sơ đồ ghế sẽ hiển thị bên phải
- Ghế được hiển thị với 2 màu:
  - 🟢 **Màu xanh lá**: Ghế trống, có thể đặt
  - 🔴 **Màu đỏ**: Ghế đã có người đặt, không thể chọn
- Nhấn vào ghế trống để chọn
- Thông tin ghế đã chọn sẽ hiển thị ở dưới cùng

#### Bước 4: Xác nhận đặt vé
1. Kiểm tra thông tin: Chuyến tàu, khách hàng, ghế đã chọn
2. Nhấn nút **"Đặt vé"**
3. Hệ thống sẽ hiển thị thông báo thành công với mã vé

### Lưu ý khi đặt vé
- Phải chọn đầy đủ: chuyến tàu, khách hàng và ghế
- Chỉ có thể chọn ghế màu xanh (trống)
- Mã vé sẽ được tạo tự động
- Giá vé được tính theo giá chuyến tàu

---

## 2. Hoàn Vé

### Quy trình hoàn vé

#### Bước 1: Chọn vé cần hoàn
1. Xem danh sách tất cả vé đã đặt trong bảng
2. Bảng hiển thị: Mã vé, Mã tàu, Khách hàng, Ngày đặt, Số ghế, Giá, Trạng thái
3. Nhấn vào dòng vé cần hoàn

#### Bước 2: Xem chi tiết vé
- Sau khi chọn vé, thông tin chi tiết sẽ hiển thị bên dưới:
  - Mã vé
  - Mã tàu
  - Khách hàng
  - Nhân viên đặt vé
  - Ngày đặt
  - Số ghế
  - Giá vé
  - Trạng thái

#### Bước 3: Xác nhận hoàn vé
1. Kiểm tra kỹ thông tin vé
2. Nhấn nút **"Hoàn vé"** (màu đỏ)
3. Xác nhận trong hộp thoại
4. Hệ thống sẽ:
   - Đổi trạng thái vé thành "Đã hoàn"
   - Giải phóng ghế (chuyển về trạng thái trống)
   - Cập nhật số ghế trống của chuyến tàu

### Lưu ý khi hoàn vé
- Chỉ có thể hoàn vé ở trạng thái "Đã đặt"
- Vé đã hoàn không thể đặt lại
- Ghế sẽ được giải phóng cho khách khác đặt

---

## 3. Đổi Vé (Tính năng mới)

### Quy trình đổi vé

#### Bước 1: Chọn vé cần đổi
1. Xem danh sách vé đã đặt trong bảng trên cùng
2. Nhấn vào vé cần đổi
3. Mã vé sẽ hiển thị trong trường "Mã vé cần đổi"

#### Bước 2: Chọn chuyến tàu mới
1. Chọn chuyến tàu mới từ dropdown
2. Có thể chọn cùng chuyến tàu (chỉ đổi ghế) hoặc chuyến khác
3. Nhấn "Làm mới" nếu cần cập nhật danh sách

#### Bước 3: Chọn toa và ghế mới
- Tương tự như đặt vé:
  1. Chọn toa từ danh sách bên trái
  2. Chọn ghế trống (màu xanh) từ sơ đồ
  3. Thông tin ghế mới sẽ hiển thị ở dưới

#### Bước 4: Xác nhận đổi vé
1. Kiểm tra thông tin:
   - Vé cũ
   - Chuyến tàu mới
   - Ghế mới
2. Nhấn nút **"Đổi vé"**
3. Xác nhận trong hộp thoại
4. Hệ thống sẽ:
   - Giải phóng ghế cũ
   - Đặt ghế mới
   - Cập nhật thông tin vé (chuyến, ghế, giá)

### Lưu ý khi đổi vé
- Chỉ có thể đổi vé ở trạng thái "Đã đặt"
- Ghế cũ sẽ tự động được giải phóng
- Giá vé sẽ được cập nhật theo chuyến tàu mới
- Có thể đổi cùng chuyến nhưng khác ghế
- Có thể đổi sang chuyến khác hoàn toàn

---

## Màu sắc và ký hiệu

### Trạng thái ghế
- 🟢 **Xanh lá (Green)**: Ghế trống, có thể đặt
- 🔴 **Đỏ (Red)**: Ghế đã đặt, không thể chọn

### Trạng thái vé
- **Đã đặt** (BOOKED): Vé đang hoạt động
- **Đã hoàn** (REFUNDED): Vé đã hoàn tiền
- **Đã hủy** (CANCELLED): Vé đã bị hủy (không còn sử dụng)

### Màu nút
- **Xanh dương**: Các nút thao tác chính (Đặt vé, Làm mới)
- **Đỏ**: Các nút cảnh báo (Hoàn vé)
- **Xám**: Các nút hủy bỏ

---

## Cấu trúc Toa và Ghế

### Loại toa tàu
1. **Ghế ngồi cứng**: 64 ghế
2. **Ghế ngồi mềm**: 48 ghế
3. **Giường nằm 6**: 36 giường
4. **Giường nằm 4**: 24 giường

### Sơ đồ ghế
- Ghế được hiển thị dạng lưới 4 cột
- Mỗi ghế có số hiệu (01, 02, 03, ...)
- Nhấn vào ghế để chọn
- Chỉ có thể chọn 1 ghế tại 1 thời điểm

---

## Các tình huống thường gặp

### Tình huống 1: Khách hàng muốn đổi ghế trong cùng toa
1. Chọn "Đổi vé"
2. Chọn vé cần đổi
3. Chọn lại cùng chuyến tàu
4. Chọn cùng toa
5. Chọn ghế mới (màu xanh)
6. Xác nhận đổi vé

### Tình huống 2: Khách hàng muốn đổi sang chuyến khác
1. Chọn "Đổi vé"
2. Chọn vé cần đổi
3. Chọn chuyến tàu mới
4. Chọn toa và ghế mới
5. Xác nhận đổi vé
6. Giá vé sẽ được cập nhật

### Tình huống 3: Khách hàng muốn hủy vé
- Sử dụng chức năng **"Hoàn vé"**
- Không còn chức năng "Hủy vé" riêng
- Vé hoàn sẽ giải phóng ghế cho khách khác

### Tình huống 4: Tất cả ghế đã hết
- Sơ đồ ghế sẽ hiển thị toàn màu đỏ
- Không thể chọn bất kỳ ghế nào
- Thông báo cho khách hàng chọn chuyến khác

---

## Lỗi thường gặp và cách khắc phục

### Lỗi: "Vui lòng chọn đầy đủ thông tin"
**Nguyên nhân**: Chưa chọn đủ chuyến tàu, khách hàng, hoặc ghế
**Giải pháp**: Kiểm tra và chọn đầy đủ các trường bắt buộc

### Lỗi: "Ghế không khả dụng"
**Nguyên nhân**: Ghế đã được người khác đặt trong lúc bạn chọn
**Giải pháp**: Làm mới và chọn ghế khác

### Lỗi: "Không thể đổi vé"
**Nguyên nhân**: Vé không ở trạng thái "Đã đặt"
**Giải pháp**: Chỉ có thể đổi vé đang hoạt động

### Lỗi: "Không thể hoàn vé"
**Nguyên nhân**: Vé đã được hoàn hoặc hủy trước đó
**Giải pháp**: Kiểm tra trạng thái vé trong bảng

---

## Tips và Tricks

### Cho nhân viên
1. **Làm mới thường xuyên**: Nhấn "Làm mới" để cập nhật danh sách tàu và khách hàng
2. **Kiểm tra kỹ thông tin**: Xác nhận lại với khách hàng trước khi đặt/đổi vé
3. **Hướng dẫn khách**: Giải thích rõ sự khác biệt giữa hoàn vé và đổi vé
4. **Ghi chú mã vé**: Lưu lại mã vé cho khách hàng để dễ tra cứu

### Cho quản lý
1. **Theo dõi hoàn vé**: Kiểm tra tỷ lệ hoàn vé trong thống kê
2. **Phân bổ toa**: Đảm bảo mỗi tàu có đủ các loại toa
3. **Giá vé**: Thiết lập giá phù hợp cho từng chuyến
4. **Đào tạo nhân viên**: Hướng dẫn nhân viên sử dụng giao diện mới

---

## Câu hỏi thường gặp (FAQ)

**Q: Có thể đặt nhiều vé cùng lúc không?**
A: Hiện tại mỗi lần chỉ đặt được 1 vé. Để đặt nhiều vé, thực hiện từng vé một.

**Q: Có thể hủy thao tác đặt vé không?**
A: Trước khi nhấn "Đặt vé", có thể nhấn "Hủy" để clear selection. Sau khi đặt, chỉ có thể hoàn vé.

**Q: Khách hàng có thể tự đổi vé không?**
A: Không, chỉ nhân viên mới có quyền thực hiện các thao tác với vé.

**Q: Giá vé đổi có khác giá vé cũ không?**
A: Có, giá vé sẽ được cập nhật theo giá của chuyến tàu mới.

**Q: Có thể xem lịch sử đổi vé không?**
A: Hiện tại chưa có. Chỉ lưu trạng thái hiện tại của vé.

**Q: Database có lưu thông tin ghế không?**
A: Có, tất cả thông tin về toa, ghế và trạng thái được lưu trong SQL Server.

---

## Hỗ trợ kỹ thuật

Nếu gặp vấn đề kỹ thuật:
1. Kiểm tra kết nối SQL Server
2. Xem log trong console
3. Liên hệ quản trị hệ thống
4. Tạo issue trên GitHub: https://github.com/KbRockzz/QLVeTau/issues

---

**Phiên bản**: 2.0  
**Cập nhật**: 2024-10-11  
**Tác giả**: KbRockzz
